<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>钧鸢的阿拉伯语记忆</title>
    <link rel="icon" href="data:,">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+Arabic:wght@400;700&family=Noto+Sans+SC:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="style.css">
    <!-- 引入 Font Awesome 免费版，用于设置图标 -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
    <link rel="manifest" href="/manifest.json">
</head>
<body>

    <!-- 页面容器 -->
    <div class="app-container">
        <!-- 学习页面 -->
        <div id="study-page" class="page">
            
            <div class="page-content">
                <div id="card-container">
                    <!-- 进度条 -->
                    <div id="progress-container">
                        <div id="progress-bar">0%</div>
                    </div>
                    
                    <!-- 闪卡内容将由JavaScript动态组织 -->
                    <div class="flashcard">
                        <div id="word-display-wrapper">
                            <h2 id="word-display"></h2>
                            <button id="tts-play-btn" class="tts-play-btn" title="播放发音">
                                <i class="fas fa-volume-up"></i>
                            </button>
                        </div>
                        <div id="definition-toggle-container"></div>
                        <div id="answer-wrapper">
                            <div id="answer-display" class="spoiler" title="点击显示/隐藏答案"></div>
                        <div id="explanation-wrapper">
                            <p id="explanation-display" class="spoiler"></p>
                            <button id="tts-explanation-play-btn" class="tts-play-btn" title="播放解释中的发音" style="
                                position: absolute; 
                                right: 10px; 
                                bottom: 10px;
                                background: none;
                                border: none;
                                font-size: 1.2rem;
                                cursor: pointer;
                                color: #8892b0;
                                z-index: 5;
                            ">
                                <i class="fas fa-volume-up"></i>
                            </button>
                        </div>
                            <div id="recall-overlay" class="recall-overlay" style="display: none;">
                                <div class="recall-circle-timer">
                                    <svg class="timer-svg" viewBox="0 0 100 100">
                                        <circle class="timer-bg" cx="50" cy="50" r="45"></circle>
                                        <circle class="timer-progress" cx="50" cy="50" r="45"></circle>
                                    </svg>
                                    <span class="timer-countdown">5</span>
                                </div>
                                <p>请先主动回忆</p>
                            </div>
                        </div>
                    </div>

                    <!-- 控制按钮 -->
                    <div id="controls">
                        <button id="forgot-btn" class="btn"><i class="fas fa-times"></i> 忘记</button>
                        <button id="hard-btn" class="btn"><i class="fas fa-question"></i> 模糊</button> 
                        <button id="easy-btn" class="btn"><i class="fas fa-check"></i> 记得</button> 
                        <button id="next-word-in-history-btn" class="btn" style="display: none;">下一个词</button>
                    </div>
                    
                    <!-- 导航控制 -->
                    <div id="nav-controls">
                        <button id="prev-btn" class="btn">上一个词</button>
                        <button id="back-to-menu-btn" class="btn">返回</button>
                    </div>
                </div>

                <!-- 完成屏幕 -->
                <div id="completion-screen">
                    <h2>🎉 恭喜你完成了本词库的记忆 🎉</h2>
                    <p>所有单词都已牢牢记住！</p>
                    <button id="finish-back-to-menu-btn" class="btn" style="background-color: #00695c;">返回</button>
                </div>
            </div>
        </div>

        <!-- 词库页面 -->
        <div id="decks-page" class="page active">
            
            <div class="page-content">
                <div id="start-screen">
                    <!-- 规律学习区域 -->
                    <div id="regular-study-section" class="feature-section">
                        <h3>规律学习</h3>
                        <p>每日新单词 + 智能复习计划</p>
                        <div id="study-plan-display" class="study-plan-display"></div>
                        <button id="regular-study-btn" class="btn feature-btn">
                            📅 开始规律学习
                        </button>
                        <button id="switch-study-plan-btn" class="btn feature-btn secondary-btn">
                            🔄 切换学习计划
                        </button>
                    </div>

                    <div id="skeleton-loader" class="skeleton-loader">
                        <div class="skeleton-item"></div>
                        <div class="skeleton-item"></div>
                        <div class="skeleton-item"></div>
                    </div>

                    <div id="deck-selection-container"></div>

                    <div id="import-section" class="feature-section">
                        <div class="import-divider"></div>
                        <h3>导入新词库</h3>
                        <input type="file" id="file-input" accept=".json,.csv,.js,.txt" style="display: none;">
                        <button id="import-btn" class="btn feature-btn">
                            📁 从本地文件导入
                        </button>
                        <button id="online-import-btn" class="btn feature-btn" style="background: linear-gradient(135deg, #2196F3 0%, #21CBF3 100%);">
                            ☁️ 在线词库
                        </button>
                        <div id="import-info">
                            <p>支持格式：JSON、CSV、JS对象</p>
                            <details>
                                <summary>查看格式要求</summary>
                                <div class="format-example">
{"第二课：你好": [
    {
        "chinese": "谁 (疑问代词)",
        "arabic": "مَنْ",
        "explanation": "مَنْ هُوَ？ (他是谁？)"
    },
    {
        "chinese": "你 (阳性)",
        "arabic": "أَنْتَ",
        "explanation": "أَنْتَ طَالِبٌ. (你是一个男学生。)"
    },...}
]}}
                                </div>
                            </details>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- 设置页面 -->
        <div id="settings-page" class="page">
            
            <div class="page-content">
                <div class="settings-section">
                    <h3>学习模式</h3>
                    <div id="mode-selection-container">
                        <label>
                            <input type="radio" name="mode" value="zh-ar" checked> 
                            <span class="radio-label">显示中文背阿语</span>
                        </label>
                        <label>
                            <input type="radio" name="mode" value="ar-zh"> 
                            <span class="radio-label">显示阿语背中文</span>
                        </label>
                        <label>
                            <input type="radio" name="mode" value="mixed"> 
                            <span class="radio-label">混合模式</span>
                        </label>
                    </div>
                </div>

                <div class="settings-section">
                    <h3>外观设置</h3>
                    <div class="setting-item">
                        <label for="theme-select">颜色主题</label>
                        <select id="theme-select" class="theme-select">
                            <option value="default">默认</option>
                            <option value="golden-sun">金日</option>
                            <option value="sakura-pink">樱粉</option>
                            <option value="moss-green">苔绿</option>
                            <option value="night">夜间</option>
                            <option value="violet">堇紫</option>
                            <option value="crimson-red">赤红</option>
                        </select>
                    </div>
                </div>

                <div class="settings-section">
                    <h3>主动回忆</h3>
                    <div id="recall-setting-container">
                        <label>
                            <input type="checkbox" id="recall-setting"> 
                            <span class="checkbox-label">开启主动回忆遮罩</span>
                        </label>
                    </div>
                </div>

                <div class="settings-section">
                    <h3>规律学习设置</h3>
                    <div class="setting-item">
                        <label for="daily-review-words">每日总学习单词数</label>
                        <input type="number" id="daily-review-words" min="0" value="30">
                    </div>
                    <div class="setting-item">
                        <label for="daily-new-words">每日新学习单词数</label>
                        <input type="number" id="daily-new-words" min="0" value="10">
                    </div>
                </div>

                <div class="settings-section">
                    <h3>语音（TTS）设置</h3>
                    <div id="tts-settings-container">
                        <div class="setting-item">
                            <label>
                                <input type="checkbox" id="tts-enable-setting">
                                <span class="checkbox-label">启用阿拉伯语发音</span>
                            </label>
                        </div>
                        <div class="setting-item">
                            <label>
                                <input type="checkbox" id="tts-autoplay-setting">
                                <span class="checkbox-label">自动播放发音</span>
                            </label>
                        </div>
                        <div class="setting-item">
                            <label for="tts-voice-select">选择语音</label>
                            <select id="tts-voice-select">
                                <option value="">加载中...</option>
                            </select>
                        </div>
                        <div class="setting-item">
                            <label for="tts-rate-setting">语速</label>
                            <input type="range" id="tts-rate-setting" min="0.5" max="2" step="0.1" value="0.8">
                            <span id="tts-rate-value">0.8</span>
                        </div>
                        <div class="setting-item">
                            <label for="tts-pitch-setting">音调</label>
                            <input type="range" id="tts-pitch-setting" min="0" max="2" step="0.1" value="1">
                            <span id="tts-pitch-value">1.0</span>
                        </div>
                        <div class="setting-item">
                            <label for="tts-volume-setting">音量</label>
                            <input type="range" id="tts-volume-setting" min="0" max="1" step="0.1" value="1">
                            <span id="tts-volume-value">1.0</span>
                        </div>
                    </div>
                </div>

                <div class="settings-section">
                    <h3>数据管理</h3>
                    <div class="settings-buttons">
                        <button id="view-stats-btn" class="btn settings-btn">
                            <i class="fas fa-chart-bar"></i> 学习统计
                        </button>
                        <button id="export-backup-btn" class="btn settings-btn">
                            <i class="fas fa-download"></i> 导出备份
                        </button>
                        <button id="import-backup-btn" class="btn settings-btn">
                            <i class="fas fa-upload"></i> 导入备份
                        </button>
                        <button id="check-storage-btn" class="btn settings-btn">
                            <i class="fas fa-hdd"></i> 存储空间
                        </button>
                        <button id="open-clear-data-modal-btn" class="btn settings-btn danger">
                            <i class="fas fa-trash"></i> 清除数据
                        </button>
                    </div>
                </div>

                <div class="settings-section">
                    <h3>应用信息</h3>
                    <div class="app-info">
                        <p><a id="check-updates-link" href="#" class="update-link">
                            <i class="fas fa-sync-alt"></i> 检查更新
                        </a></p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 底部导航栏 -->
    <nav class="bottom-nav">
        <button class="nav-btn" data-page="study-page">
            <i class="fas fa-brain"></i>
            <span>学习</span>
        </button>
        <button class="nav-btn active" data-page="decks-page">
            <i class="fas fa-book"></i>
            <span>词库</span>
        </button>
        <button class="nav-btn" data-page="settings-page">
            <i class="fas fa-cog"></i>
            <span>设置</span>
        </button>
    </nav>

    <!-- 模态框保持不变 -->
    <div id="random-test-modal" class="modal">
        <!-- 内容保持不变 -->
    </div>

    <!-- 统计信息模态框 -->
    <div id="stats-modal" class="modal">
        <div class="modal-content">
            <h2 id="stats-modal-title">学习统计</h2>
            <div id="stats-modal-body"></div>
            <button id="stats-modal-close-btn" class="btn">关闭</button>
        </div>
    </div>

    <!-- 在线词库导入模态框 -->
    <div id="import-modal" class="modal">
        <div class="modal-content">
            <span class="close-button">&times;</span>
            <h2>在线词库</h2>
            <p class="modal-subtitle">点击词库名称即可快速导入</p>
            <div id="online-lexicon-list">
                <!-- 在线词库将由JS动态加载到这里 -->
            </div>
            <div class="modal-footer">
                <div class="import-divider"></div>
                <button id="import-local-lexicon-btn" class="btn feature-btn">
                    📁 或者...从本地文件导入
                </button>
            </div>
        </div>
    </div>

    <!-- 数据清除确认模态框 -->
    <div id="clear-data-modal" class="modal">
        <div class="modal-content">
            <span class="close-button">&times;</span>
            <h2>清除数据</h2>
            <p>选择要永久清除的数据类型。此操作不可逆。</p>
            <div class="clear-options">
                <label><input type="checkbox" name="clear-option" value="decks" checked> 所有词库 (单词及其定义)</label>
                <label><input type="checkbox" name="clear-option" value="progress" checked> 学习进度 (记忆间隔)</label>
                <label><input type="checkbox" name="clear-option" value="sessions" checked> 会话状态 (未完成的学习会话)</label>
                <label><input type="checkbox" name="clear-option" value="stats" checked> 统计数据 (学习日、首次学习日期等)</label>
                <label><input type="checkbox" name="clear-option" value="settings" checked> 应用设置 (模式、每日目标等)</label>
            </div>
            <button id="execute-clear-data-btn" class="btn danger">确认清除</button>
        </div>
    </div>

    <!-- 新增：继续会话模态框 -->
    <div id="continue-session-modal" class="modal">
        <div class="modal-content">
            <h2>发现未完成的会话</h2>
            <p>您想继续上次的学习吗？</p>
            <div class="modal-actions">
                <button id="decline-continue-btn" class="btn btn-secondary">重新开始</button>
                <button id="confirm-continue-btn" class="btn">继续学习</button>
            </div>
        </div>
    </div>

    <!-- 新增：规律学习范围选择模态框 -->
    <div id="regular-study-scope-modal" class="modal">
        <div class="modal-content">
            <span class="close-button">&times;</span>
            <h2>选择学习范围</h2>

            <!-- 新增：用于模式切换的Tab导航 -->
            <div class="study-scope-tabs">
                <button class="tab-btn active" data-tab="global">全局学习</button>
                <button class="tab-btn" data-tab="collection">学习集合</button>
                <button class="tab-btn" data-tab="deck">学习词库</button>
            </div>

            <!-- 学习选项将根据选择的Tab动态加载 -->
            <div id="regular-study-options-container">
                <!-- 全局学习面板 -->
                <div id="tab-global" class="tab-content active">
                    <p class="study-scope-description">将开始一个包含所有已导入内容的学习会话。</p>
                </div>
                <!-- 学习集合面板 -->
                <div id="tab-collection" class="tab-content">
                    <div id="collection-options-list" class="options-list">
                        <!-- 集合选项将由JS动态加载到这里 -->
                    </div>
                </div>
                <!-- 学习词库面板 -->
                <div id="tab-deck" class="tab-content">
                    <div id="deck-options-list" class="options-list">
                        <!-- 词库选项将由JS动态加载到这里 -->
                    </div>
                </div>
            </div>

            <div class="modal-actions">
                <button id="regular-study-start-btn" class="btn">开始学习</button>
            </div>
        </div>
    </div>

    <div id="notification-container"></div>

    <!-- 新增：切换学习计划模态框 -->
    <div id="study-plan-modal" class="modal">
        <div class="modal-content">
            <span class="close-button">&times;</span>
            <h2>切换学习计划</h2>
            <p class="modal-subtitle">选择一个默认的学习计划，应用启动时将自动开始。</p>
            <div id="study-plan-options-container">
                <!-- 学习计划选项将由JS动态加载 -->
            </div>
            <div class="modal-actions">
                <button id="cancel-study-plan-btn" class="btn btn-secondary">取消</button>
                <button id="confirm-study-plan-btn" class="btn">确认</button>
            </div>
        </div>
    </div>

    <script type="module" src="js/update.js"></script>
    <script type="module" src="js/main.js"></script>
    <script>
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('/sw.js').then(registration => {
                    console.log('ServiceWorker registration successful with scope: ', registration.scope);
                }, err => {
                    console.log('ServiceWorker registration failed: ', err);
                });
            });
        }
    </script>
</body>
</html>
